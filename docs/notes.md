# Interactive Brokers / IBPy / IBroke Notes

## User Notes

### Use the (Limited) Demo with no Signup
You can [download Trader Workstation](https://www.interactivebrokers.com/en/index.php?f=16040) (TWS) and use
the demo account (username `edemo`, password `demouser`) without signing up for anything.
Market data is synthesized (read: completely fake).
All settings are lost each time the application exits/restarts, which it does once a day.
In particular you will need to manually re-enable API access each time you start TWS.
You are assigned a different account number each time you log in to the demo account.  Random
trades may happen on their own.  Historical data and real-time bars are not available.

### The API is Proxied
The IB API is unusual in that you do not connect directly to IB's servers; you connect to a
(usually) locally-running instance of the Trader WorkStation application, which then proxies
your requests.  There is also a stripped-down API-only (non-GUI) dedicated proxy called the
IB Gateway.  While this seems like unnecessary complexity and delay, it has the benefit of
freeing API clients from worrying about authentication, which can be a non-trivial concern when
a lot of money is at stake.

### Real Market Data Costs Real $$$
Delayed data is not forwarded through the API: you cannot get real market data without paying.

| Account Type      | Market Data | API Access | Availability
| ------------      | ----------- | ---------- | ------------
| Demo              | Synthesized | Yes        | All hours
| Paper unfunded    | Delayed     | No         | Market hours
| Paper funded      | Real-time   | Yes        | Market hours
| Real money funded | Real-time   | Yes        | Market hours

For real-time data, you must have a funded account AND pay for a market data subscription
(generally ~$10/mo, waved if you make enough trades; forex and a few others are free).

### IB Shuts Down Every Night
IB shuts down for maintenance every night from 11:45 PM - 12:45 AM Eastern, though your account may be
available during some of this time.  Fridays they are totally down the entire time, but they start back up at 12:30 AM
instead of 12:45 AM. Orders on the books are still in force during this time.  They do not recommend
trading during this window.

### Forex
Forex (CASH instrument) quotes do not have volume or last trades (nor last trade timestamps).
IB's IDEALPRO exchange is open Sun - Fri, with a trading halt 5:00 PM - 5:15 PM Eastern.
The minimum order size is at least 20,000 (higher for some currencies).


## Implementation Notes

First, and you never see this explicitly mentioned: the IB API is asynchronous and
callback-based.  That means when you make a request there is no immediate response,
but some time later a message may arrive (and a callback will be called) with the response.
Some requests generate one or a few response messages; some subscribe to a continuous stream of
messages; and some messages arrive without any request, generated by the system.  This makes
error handling particularly challenging, because errors are disconnected from the erroneous
requests, and a successful request may be indicated by the absence of any message at all.

You must assign monotonically increasing order ids to your orders.
They only have to be monotonic per client ID, but they do persist across disconnects.
reqIds() will send one nextValidId which will give you the next highest unused number.

Positions and portfolio updates are shared between client IDs.

To get commission and PNL info you have to listen for commissionReport messages, which are generated for
every execution, and point to executions (not orders) with crazy string IDs.  So to tally commissions and PNL
per-order, you need to track a map of executions (with crazy string IDs) to orders.
You might try to use openOrder.orderState messages, but there are dupes and the commissions are often giant
placeholder values (and some other dollar values are strings...), and they don't have PNL.

There is no way to say "give me N-second OHLC bars," you have to handle ticks and build bars yourself.
There is reqRealTimeBars(), which only give 5 second bars, but doesn't seem to work with the demo account.
At any rate if you want faster than 5-second resolution, you have to do it yourself.

There is no official way to determine via the API if your account is a paper or live money account (a
potentially costly shortcoming).  The best you can do is check account numbers (your paper and live
accounts will be different).  It appears you can detect the demo account
via `reqAccountSummary()` with a tag of `AccountType` by checking for the value `UNIVERSAL` (but this
is not documented).

Historical ticks are not available; the finest resolution is 1-sec OHLC bars.

The Volume tick type (tick id 8) only fires rarely, and can change sporadically.  Best ignored.
Use RTVOLUME (request generic tick id 233, tick type 48) instead

### Documentation links
* https://www.interactivebrokers.com/en/software/api/api_Left.htm  - slightly more correct
* https://xavierib.github.io/twsapidocs/index.html - slightly more updated
* http://files.meetup.com/1551526/Interactive_Brokers_API.pdf - (Java) implementation notes

## Development Roadmap




